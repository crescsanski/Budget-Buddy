<div class="panel">
    <div class="content-area" style="margin-left: 0; ">
        <div class="header">
            <h2>Receipts</h2> 
        </div>
        <div style="display: inline-flex; width: 100%">
            <div #receiptList>
                <div *ngFor="let item of userReceipts" style="display: inline-flex;">
                    <div *ngIf="item == selectedReceipt" class="receipt-list selected" style="position: relative">
                        <p style="font-weight: bolder; font-size: 800; text-align: left;">{{item.receipt_name}} <img class="edit-button" src="../../../assets/icons/trash.png" style="width:1em; position: absolute; right: 1em; border-radius: 100" (click)="openDeleteReceipt(item)"><img class="edit-button" src="../../../assets/icons/edit-icon.png" style="width:1em; position: absolute; right: 2.5em; border-radius: 100" (click)="openReceiptEditor(item)"></p>
                        <p style="margin-top: -15px">${{item.receipt_amount}} <span style="text-align: left; margin-left: 2.5em">{{item.receipt_date}}</span></p>
                    </div>
                    <div *ngIf="item != selectedReceipt" class="receipt-list" (click)="selectReceipt(item)" style="position: relative">
                        <p style="font-weight: bolder; font-size: 800; text-align: left;">{{item.receipt_name}} <img class="edit-button" src="../../../assets/icons/trash.png" style="width:1em; position: absolute; right: 1em; border-radius: 100" (click)="openDeleteReceipt(item)"><img class="edit-button" src="../../../assets/icons/edit-icon.png" style="width:1em; position: absolute; right: 2.5em; border-radius: 100" (click)="openReceiptEditor(item)"></p>
                        <p style="margin-top: -15px">${{item.receipt_amount}} <span style="text-align: left; margin-left: 2.5em">{{item.receipt_date}}</span></p>
                    </div>
                </div>
            </div>
            <div class="image-area" style="display: block; text-align: center;">
                <img src="{{imageUpload}}">
                <div *ngIf="imageUpload == noUpload" style="text-align: center;">
                    <p-button (click)="op.toggle($event)">Upload Receipt</p-button>
                </div>
            </div>
        </div>
        <p-overlayPanel [showTransitionOptions]="'0ms'" [hideTransitionOptions]="'0ms'" #op [dismissable]="true" [showCloseIcon]="true">
            <ng-template pTemplate>
                <p-fileUpload name="demo[]" url="./upload.php" (onUpload)="onUpload($event)"
                    accept="image/*">
                    <ng-template pTemplate="content">
                         <ul *ngIf="receipts.length">
                            <li *ngFor="let file of receipts">{{file.name}} - {{file.size}} bytes</li>
                         </ul>
                     </ng-template>
                </p-fileUpload>
            </ng-template>
        </p-overlayPanel> 
        <p-dialog header="Edit: {{selectedReceipt.receipt_name}}" [(visible)]="editReceipt" [appendTo]="receiptList" style="width:fit-content">
            <div>
                <div *ngIf="selectedReceipt">
                    <form [formGroup]="form">
                        <div style="text-align: center;">
                            <p style="text-align: left;">Name</p>
                            <input formControlName="receipt_name" type="text" placeholder="{{selectedReceipt.receipt_name}}" pInputText/>
                            <br>
                            <p style="text-align: left;">Date</p>
                            <p-calendar formControlName="receipt_date" placeholder="{{selectedReceipt.receipt_date}}"></p-calendar>
                            <br>
                            <p style="text-align: left;">Amount</p>
                            <p-inputNumber style="text-align: left;" formControlName="income_amount" placeholder="{{selectedReceipt.receipt_amount}}"
                            mode="currency" currency="USD" locale="en-US"></p-inputNumber>
                            <br>
                            <p style="text-align: left;">Monthly Recurrence</p>
                            <p-dropdown [options]="frequencyOptions"
                            [autoDisplayFirst]=false
                            placeholder="Optional"
                            formControlName="reocurring"></p-dropdown>
                            <br>
                            <button style="margin-top: 2em; display: inline-flex; text-align: center;" class="track" pButton type="submit" label='Track' (click)="updateReceipt()"></button>
                        </div>
                    </form>
                </div>
            </div>
        </p-dialog>
        <p-dialog header="{{selectedReceipt.receipt_name}}" [(visible)]="showReceipt" [appendTo]="receiptList" style="width:fit-content">
            <div>
                <div *ngIf="selectedReceipt">
                    <p style="text-align: left;"><span style="font-weight: bolder;">Receipt ID: </span>{{selectedReceipt.receipt_id}}</p>
                    <p style="text-align: left;"><span style="font-weight: bolder;">Date: </span>${{selectedReceipt.receipt_date}}</p>
                    <p style="text-align: left;"><span style="font-weight: bolder;">Amount: </span>${{selectedReceipt.receipt_amount}}</p>
                </div>
            </div>
        </p-dialog>
        <p-dialog header="Delete: {{selectedReceipt.receipt_name}}" [(visible)]="deleteReceipt" [appendTo]="receiptList" style="width:fit-content">
            <div style="text-align: center;">
                <h3 class="message">Are you sure? <br> You are about to delete:<br><br><span style="color:#4ec5ca; font-size: larger;"> {{selectedReceipt.receipt_name}}</span><br><br>
                This cannot be undone.</h3>
            
                <button style="margin: 1em; display: inline-flex; text-align: center;" class="track" pButton type="submit" label='Yes, Delete' (click)="confirmDeleteReceipt()"></button>
                <button style="margin: 1em; display: inline-flex; text-align: center;" class="button-secondary"pButton type="submit" label='No, Keep' (click)="denyDeleteReceipt()"></button>
            </div>
        </p-dialog>
        <p-dialog header="Verify Upload Values" [(visible)]="receiptUploaded" [appendTo]="receiptList" style="width:fit-content">
            <div>
                <div *ngIf="receiptUploaded" class="upload-verification">
                    <form [formGroup]="form">
                        <div style="text-align: center;">
                            <p>Name</p>
                            <input formControlName="receipt_name" type="text" pInputText/>
                            <br>
                            <p>Date</p>
                            <p-calendar formControlName="receipt_date"></p-calendar>
                            <br>
                            <p>Spending Category</p>
                            <p-dropdown [options]="catOptions" optionLabel="category_name" optionValue="category_id" 
                            [autoDisplayFirst]=false
                            formControlName="category"></p-dropdown>
                            <br>
                            <p>Amount</p>
                            <p-inputNumber formControlName="income_amount" 
                            mode="currency" currency="USD" locale="en-US"></p-inputNumber>
                            <br>
                            <p>Monthly Recurrence</p>
                            <p-dropdown [options]="frequencyOptions"
                            [autoDisplayFirst]=false
                            placeholder="Optional"
                            formControlName="reocurring"></p-dropdown>
                            <br>
                            <button style="margin-top: 2em; display: inline-flex;" class="track" pButton type="submit" label='Track'></button>
                        </div>
                    </form>
                </div>
            </div>
        </p-dialog> 
        
</div>

